package com.todo.todo.Controller;

import com.todo.todo.Controller.Mapper.TodoMapper;
import com.todo.todo.Controller.Responses.TodoResponse;
import com.todo.todo.Model.TodoEntity;
import com.todo.todo.Service.TodoService;
import jakarta.websocket.server.PathParam;
import lombok.RequiredArgsConstructor;
import lombok.val;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import javax.swing.text.html.Option;
import java.util.List;
import java.util.Optional;
import java.util.stream.Stream;

@RestController
@RequestMapping("/todo_app/todo")
@RequiredArgsConstructor
public class TodoController {

    private final TodoService todoService;

    @GetMapping("/")
    public ResponseEntity<List<TodoResponse>> getTodos() {
        List<TodoEntity> todos = todoService.getTodos();
        Stream<TodoResponse> todoResponses = todos.stream().map(TodoMapper::toTodoResponse);
        return ResponseEntity.ok(todoResponses.toList());
    }

    @GetMapping("/{id}")
    public ResponseEntity<TodoResponse> getTodo(@PathVariable("id") Long id) {
        return todoService.getTodo(id)
                .map(TodoMapper::toTodoResponse)
                .map(ResponseEntity::ok)
                .orElse(ResponseEntity.notFound().build());
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteTodo(@PathVariable("id") Long id) {
        Optional<TodoEntity> response = todoService.getTodo(id);

        if(response.isPresent()) todoService.deleteTodo(id);

        else return ResponseEntity.notFound().build();

        return ResponseEntity.ok().build();
    }

    @PutMapping("/{id}")
    public ResponseEntity<TodoResponse> updateTodo(@PathVariable("id") Long id, @RequestBody TodoEntity todoEntity) {
        System.out.println(todoEntity.getUser());
        Optional<TodoEntity> response = todoService.updateTodo(id, todoEntity);
        return response.map(TodoMapper::toTodoResponse).map(ResponseEntity::ok).orElse(ResponseEntity.notFound().build());
    }

    @PostMapping("/")
    public ResponseEntity<TodoResponse> createTodo(@RequestBody TodoEntity todoEntity) {
        System.out.println(todoEntity.getUser());   
        TodoEntity todoCreated = todoService.createTodo(todoEntity);
        return ResponseEntity.ok(TodoMapper.toTodoResponse(todoCreated));
    }
}
